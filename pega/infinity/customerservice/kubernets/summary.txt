/ * Reference Links link */
https://github.com/kodekloudhub/certified-kubernetes-administrator-course
https://minikube.sigs.k8s.io/docs/start/

/* Installation Commands */
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-arm64
sudo install minikube-darwin-arm64 /usr/local/bin/minikube

minikube start
üòÑ  minikube v1.31.2 on Darwin 13.6 (arm64)
‚ú®  Automatically selected the docker driver
üìå  Using Docker Desktop driver with root privileges
üëç  Starting control plane node minikube in cluster minikube
üöú  Pulling base image ...
üíæ  Downloading Kubernetes v1.27.4 preload ...
    > preloaded-images-k8s-v18-v1...:  327.74 MiB / 327.74 MiB  100.00% 34.79 M
    > gcr.io/k8s-minikube/kicbase...:  404.50 MiB / 404.50 MiB  100.00% 22.29 M
üî•  Creating docker container (CPUs=2, Memory=4000MB) ...
üê≥  Preparing Kubernetes v1.27.4 on Docker 24.0.4 ...
    ‚ñ™ Generating certificates and keys ...
    ‚ñ™ Booting up control plane ...
    ‚ñ™ Configuring RBAC rules ...
üîó  Configuring bridge CNI (Container Networking Interface) ...
üîé  Verifying Kubernetes components...
    ‚ñ™ Using image gcr.io/k8s-minikube/storage-provisioner:v5
üåü  Enabled addons: storage-provisioner, default-storageclass
üèÑ  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default


kubectl get po -A
minikube kubectl -- get po -A
NAMESPACE              NAME                                         READY   STATUS    RESTARTS        AGE
kube-system            coredns-5d78c9869d-4zg6n                     1/1     Running   0               3m28s
kube-system            etcd-minikube                                1/1     Running   0               3m42s
kube-system            kube-apiserver-minikube                      1/1     Running   0               3m42s
kube-system            kube-controller-manager-minikube             1/1     Running   0               3m42s
kube-system            kube-proxy-cbr9z                             1/1     Running   0               3m29s
kube-system            kube-scheduler-minikube                      1/1     Running   0               3m42s
kube-system            storage-provisioner                          1/1     Running   1 (2m58s ago)   3m41s
kubernetes-dashboard   dashboard-metrics-scraper-5dd9cbfd69-g9jcz   1/1     Running   0               87s
kubernetes-dashboard   kubernetes-dashboard-5c5cfc8747-9942m        1/1     Running   0               87s

kubectl get pods --namespace kube-system
NAME                               READY   STATUS    RESTARTS      AGE
coredns-5d78c9869d-4zg6n           1/1     Running   0             18m
etcd-minikube                      1/1     Running   0             18m
kube-apiserver-minikube            1/1     Running   0             18m
kube-controller-manager-minikube   1/1     Running   0             18m
kube-proxy-cbr9z                   1/1     Running   0             18m
kube-scheduler-minikube            1/1     Running   0             18m
storage-provisioner                1/1     Running   1 (17m ago)   18m

kubectl get pods --namespace default
No resources found in default namespace.

minikube dashboard
http://127.0.0.1:64572/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/#/ingress?namespace=default

/* Kubernets Architecture */
Node 
Cluster
Components
 - API Server
 - etcd service
 - kubectl service
 - Container Runtime
 - Controller
 - Scheduler

/* Kubectl commands */
kubectl run hello-minikube
error: required flag(s) "image" not set

kubectl cluster-info
Kubernetes control plane is running at https://127.0.0.1:64506
CoreDNS is running at https://127.0.0.1:64506/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

kubectl get nodes
NAME       STATUS   ROLES           AGE   VERSION
minikube   Ready    control-plane   31m   v1.27.4

Container Runtime Interface ( CRI )
Open Container Initiative
 - imagespec
 - runtimespec
 - dockershim
   - CLI
   - API
   - Build
   - Volumes
   - Auth
   - Security

/* Container D installation */
https://github.com/containerd/containerd/blob/main/docs/getting-started.md
/* nerdctl docker compatible */
https://github.com/containerd/nerdctl
/* crictl */

/* kubectl describe command */
kubectl describe pod my-app
Name:             my-app
Namespace:        default
Priority:         0
Service Account:  default
Node:             minikube/192.168.49.2
Start Time:       Sun, 01 Oct 2023 00:43:20 -0500
Labels:           app=my-app
                  type=front-end
Annotations:      <none>
Status:           Running
IP:               10.244.0.5
IPs:
  IP:  10.244.0.5
Containers:
  nginx-container:
    Container ID:   docker://0a666b01a3bf5be3021e0cf121e9158160134ed1d4aaef72e43c1a612cabe8e9
    Image:          nginx
    Image ID:       docker-pullable://nginx@sha256:32da30332506740a2f7c34d5dc70467b7f14ec67d912703568daff790ab3f755
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Sun, 01 Oct 2023 00:43:26 -0500
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-rcg5w (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  kube-api-access-rcg5w:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age    From               Message
  ----    ------     ----   ----               -------
  Normal  Scheduled  2m27s  default-scheduler  Successfully assigned default/my-app to minikube
  Normal  Pulling    2m26s  kubelet            Pulling image "nginx"
  Normal  Pulled     2m21s  kubelet            Successfully pulled image "nginx" in 5.069936628s (5.069942711s including waiting)
  Normal  Created    2m21s  kubelet            Created container nginx-container
  Normal  Started    2m21s  kubelet            Started container nginx-container

/* kubectl apply command */
Warning: resource pods/my-app is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.
pod/my-app configured

error: error parsing pod-definition.yml: error converting YAML to JSON: yaml: line 10: found character that cannot start any token
pod/my-app unchanged

/* kubectl describe pod nginx-2 */
Name:             nginx-2
Namespace:        default
Priority:         0
Service Account:  default
Node:             minikube/192.168.49.2
Start Time:       Sun, 01 Oct 2023 09:22:09 -0500
Labels:           env=production
                  name=myapp
Annotations:      <none>
Status:           Running
IP:               10.244.0.6
IPs:
  IP:  10.244.0.6
Containers:
  nginx:
    Container ID:   docker://60b33826dd2742af9656cb4870a05f243baeeddbcf3409c9b0bf121c0f855e67
    Image:          nginx
    Image ID:       docker-pullable://nginx@sha256:32da30332506740a2f7c34d5dc70467b7f14ec67d912703568daff790ab3f755
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Sun, 01 Oct 2023 09:22:11 -0500
    Ready:          True
    Restart Count:  0
    Limits:
      cpu:     500m
      memory:  128Mi
    Requests:
      cpu:        500m
      memory:     128Mi
    Environment:  <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-hnf8p (ro)
  busybox:
    Container ID:   docker://93b0c83258e99dbfbfb896dee513c0406a081175508a689be43e56eff809fd38
    Image:          busybox
    Image ID:       docker-pullable://busybox@sha256:3fbc632167424a6d997e74f52b878d7cc478225cffac6bc977eedfe51c7f4e79
    Port:           <none>
    Host Port:      <none>
    State:          Waiting
      Reason:       CrashLoopBackOff
    Last State:     Terminated
      Reason:       Completed
      Exit Code:    0
      Started:      Sun, 01 Oct 2023 09:22:57 -0500
      Finished:     Sun, 01 Oct 2023 09:22:57 -0500
    Ready:          False
    Restart Count:  3
    Limits:
      cpu:     500m
      memory:  128Mi
    Requests:
      cpu:        500m
      memory:     128Mi
    Environment:  <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-hnf8p (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             False 
  ContainersReady   False 
  PodScheduled      True 
Volumes:
  kube-api-access-hnf8p:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   Guaranteed
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason     Age                From               Message
  ----     ------     ----               ----               -------
  Normal   Scheduled  82s                default-scheduler  Successfully assigned default/nginx-2 to minikube
  Normal   Pulling    81s                kubelet            Pulling image "nginx"
  Normal   Pulled     81s                kubelet            Successfully pulled image "nginx" in 596.362416ms (596.37875ms including waiting)
  Normal   Created    80s                kubelet            Created container nginx
  Normal   Started    80s                kubelet            Started container nginx
  Normal   Pulled     79s                kubelet            Successfully pulled image "busybox" in 1.541108917s (1.541121543s including waiting)
  Normal   Pulled     78s                kubelet            Successfully pulled image "busybox" in 508.550542ms (508.574417ms including waiting)
  Normal   Pulled     64s                kubelet            Successfully pulled image "busybox" in 551.421833ms (551.449208ms including waiting)
  Normal   Pulling    34s (x4 over 80s)  kubelet            Pulling image "busybox"
  Normal   Created    34s (x4 over 79s)  kubelet            Created container busybox
  Normal   Started    34s (x4 over 79s)  kubelet            Started container busybox
  Normal   Pulled     34s                kubelet            Successfully pulled image "busybox" in 583.069126ms (583.099042ms including waiting)
  Warning  BackOff    33s (x5 over 77s)  kubelet            Back-off restarting failed container busybox in pod nginx-2_default(3c06bc7f-36ce-4b33-ad14-08f9f6fac044)

/* kubectl logs nginx-2 */
Defaulted container "nginx" out of: nginx, busybox
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2023/10/01 14:22:11 [notice] 1#1: using the "epoll" event method
2023/10/01 14:22:11 [notice] 1#1: nginx/1.25.2
2023/10/01 14:22:11 [notice] 1#1: built by gcc 12.2.0 (Debian 12.2.0-14) 
2023/10/01 14:22:11 [notice] 1#1: OS: Linux 6.3.13-linuxkit
2023/10/01 14:22:11 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2023/10/01 14:22:11 [notice] 1#1: start worker processes
2023/10/01 14:22:11 [notice] 1#1: start worker process 29
2023/10/01 14:22:11 [notice] 1#1: start worker process 30
2023/10/01 14:22:11 [notice] 1#1: start worker process 31
2023/10/01 14:22:11 [notice] 1#1: start worker process 32
2023/10/01 14:22:11 [notice] 1#1: start worker process 33

/* kubectl get deployments */
No resources found in default namespace.
/* kubectl create deployment kubernetes-bootcamp --image=gcr.io/google-samples/kubernetes-bootcamp:v1 */
deployment.apps/kubernetes-bootcamp created
/* kubectl get deployments */
NAME                  READY   UP-TO-DATE   AVAILABLE   AGE
kubernetes-bootcamp   1/1     1            1           8

